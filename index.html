<!DOCTYPE html>
<html>

<head>
  <meta charset='utf-8'>
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <meta name="description" content="express-restify-mongoose : Easily create a flexible REST interface from mongoose schemas">
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/github-fork-ribbon-css/0.1.1/gh-fork-ribbon.min.css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.5/cosmo/bootstrap.min.css">
  <link rel="stylesheet" href="css/main.css">
  <title>express-restify-mongoose : Easily create a flexible REST interface for mongoose models</title>
</head>

<body>

  <header class="container-fluid">
    <div class="row">
      <div class="col-md-offset-1 col-md-7">
        <h1>express-restify-mongoose</h1>
        <h2>Easily create a flexible REST interface for mongoose models</h2>
      </div>
    </div>
  </header>

  <hr>

  <div class="github-fork-ribbon-wrapper right">
    <div class="github-fork-ribbon">
      <a href="https://github.com/florianholzapfel/express-restify-mongoose">Contribute on GitHub</a>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row">
      <div class="col-md-offset-1 col-md-8">
        <section id="getting-started">
          <h2 class="section-header">
            <a class="section-anchor" href="#getting-started">
              <span class="glyphicon glyphicon-link"></span>
            </a>Getting started
          </h2>

          <pre class="hljs"><code>npm install express-restify-mongoose --save</code></pre>

          <h3 id="express4" class="section-header">
            <a class="section-anchor" href="#express4">
              <span class="glyphicon glyphicon-link"></span>
            </a>Express 4 app
          </h3>

          <div class="row">
            <div class="col-md-6">
              <p>This snippet...</p>

              <pre class="hljs"><code>var express = require('express')
var bodyParser = require('body-parser')
var methodOverride = require('method-override')
var mongoose = require('mongoose')
var restify = require('express-restify-mongoose')
var app = express()
var router = express.Router()

app.use(bodyParser.json())
app.use(methodOverride())

mongoose.connect('mongodb://localhost/database')

restify.serve(router, mongoose.model('Customer', new mongoose.Schema({
  name: { type: String, required: true },
  comment: { type: String }
})))

restify.serve(router, mongoose.model('Invoice', new mongoose.Schema({
  customer: { type: Schema.Types.ObjectId, ref: 'Customer' },
  amount: { type: Number, required: true }
})))

app.use(router)

app.listen(3000, function () {
  console.log('Express server listening on port 3000')
})</code></pre>
            </div>
            <div class="col-md-6">
              <p>...automatically generates those endpoints.</p>

              <pre class="hljs"><code>GET http://localhost/api/v1/Customers/count
GET http://localhost/api/v1/Customers
PUT http://localhost/api/v1/Customers
POST http://localhost/api/v1/Customers
DELETE http://localhost/api/v1/Customers

GET http://localhost/api/v1/Customers/:id
GET http://localhost/api/v1/Customers/:id/shallow
PUT http://localhost/api/v1/Customers/:id
POST http://localhost/api/v1/Customers/:id
DELETE http://localhost/api/v1/Customers/:id</code></pre>

              <pre class="hljs"><code>GET http://localhost/api/v1/Invoices/count
GET http://localhost/api/v1/Invoices
PUT http://localhost/api/v1/Invoices
POST http://localhost/api/v1/Invoices
DELETE http://localhost/api/v1/Invoices

GET http://localhost/api/v1/Invoices/:id
GET http://localhost/api/v1/Invoices/:id/shallow
PUT http://localhost/api/v1/Invoices/:id
POST http://localhost/api/v1/Invoices/:id
DELETE http://localhost/api/v1/Invoices/:id</code></pre>
            </div>
          </div>

          <h3 id="request" class="section-header">
            <a class="section-anchor" href="#request">
              <span class="glyphicon glyphicon-link"></span>
            </a>Usage with <a href="https://www.npmjs.com/package/request">request</a>
          </h3>

          <pre class="hljs"><code>var query = {
  $or: [{
    name: '~Another'
  }, {
    $and: [{
      name: '~Product'
    }, {
      price: '&lt;=10'
    }]
  }],
  price: 20
}

request({
  url: '/api/v1/Model',
  qs: {
    query: encodeURIComponent(JSON.stringify(query)
  }
})</code></pre>

        </section>
        <hr>
        <section id="query">
          <h2 class="section-header">
            <a class="section-anchor" href="#query">
              <span class="glyphicon glyphicon-link"></span>
            </a>Query
          </h2>

          <h3 id="operators" class="section-header">
            <a class="section-anchor" href="#operators">
              <span class="glyphicon glyphicon-link"></span>
            </a>Operators
          </h3>

          <pre class="hljs"><code>GET http://localhost/api/v1/Customers?name=~regex
GET http://localhost/api/v1/Customers?name=value
GET http://localhost/api/v1/Customers?name=&gt;value
GET http://localhost/api/v1/Customers?name=&gt;=value
GET http://localhost/api/v1/Customers?name=&lt;value
GET http://localhost/api/v1/Customers?name=&lt;=value
GET http://localhost/api/v1/Customers?name=!=value
GET http://localhost/api/v1/Customers?select=name
GET http://localhost/api/v1/Customers?select=-name</code></pre>

          <h3>Sort, skip and limit</h3>

          <pre class="hljs"><code>GET http://localhost/api/v1/Customers?sort=name
GET http://localhost/api/v1/Customers?sort=-name
GET http://localhost/api/v1/Customers?skip=10&amp;limit=10</code></pre>

          <h3>Populate</h3>

          <pre class="hljs"><code>GET http://localhost/api/v1/Invoices?populate=customer
GET http://localhost/api/v1/Invoices?populate=customer&amp;select=customer.name

# populate fields will not have effect on select fields as supported by Mongoose
# populate fields will be fetched along with select fields
GET http://localhost/api/v1/Invoices?populate=customer
GET http://localhost/api/v1/Invoices?populate=customer&amp;select=amount
GET http://localhost/api/v1/Invoices?populate=customer&amp;select=customer,amount
GET http://localhost/api/v1/Invoices?populate=customer&amp;select=customer.name,amount</code></pre>
        </section>

        <hr>

        <section id="reference">
          <h2 class="section-header">
            <a class="section-anchor" href="#reference">
              <span class="glyphicon glyphicon-link"></span>
            </a>Reference
          </h2>

          <h3 id="serve" class="section-header">
            <a class="section-anchor" href="#serve">
              <span class="glyphicon glyphicon-link"></span>
            </a>serve
          </h3>

          <pre class="hljs"><code>restify.serve(router, model[, options])</code></pre>
          <p><strong>router</strong>: express.Router() instance (Express 4) or app object (Express 3)</p>
          <p><strong>model</strong>: mongoose model</p>
          <p>
            <strong>options</strong>: object
            <span class="label label-primary">type</span>
            <span class="label label-success">default</span>
            <span class="label label-info">version</span>
          </p>

          <ul>
            <li>
              <h4>
                strict
                <span class="label label-primary" title="type">boolean</span>
                <span class="label label-success" title="default">true</span>
              </h4>
              <p>true disallows DELETE all, POST with id param, and PUT without id param</p>
            </li>
            <li>
              <h4>
                prefix
                <span class="label label-primary" title="type">string</span>
                <span class="label label-success" title="default">/api</span>
              </h4>
              <p>Path to prefix to the REST endpoint.</p>
            </li>
            <li>
              <h4>
                version
                <span class="label label-primary" title="type">string</span>
                <span class="label label-success" title="default">/v1</span>
              </h4>
              <p>API version that will be prefixed to the rest path.</p>
              <p>If prefix or version contains <code>/:id</code>, then that will be used as the location to search for the id.</p>
              <h5>Example</h5>
              <p><code>version: '/v1/Entities/:id'</code> generates <code>/api/v1/Entities/:id/Model</code> and <code>/api/v1/Entities/Model</code> for all pertinent methods</p>
            </li>
            <li>
              <h4>
                idProperty
                <span class="label label-primary" title="type">string</span>
                <span class="label label-success" title="default">_id</span>
              </h4>
              <p><code>findById</code> and <code>findByIdAnd*</code> methods will query on the given property</p>
            </li>
            <li>
              <h4>
                middleware
                <span class="label label-primary" title="type">array</span>
              </h4>
              <p>An Express middleware or an array of express middlewares that will be used.</p>
              <h5>Example</h5>
              <pre class="hljs"><code>middleware: function (req, res, next) {
  console.log('Incoming %s request', req.method)
}</code></pre>
            </li>
            <li>
              <h4>
                prereq
                <span class="label label-primary" title="type">boolean</span>
                <span class="label label-success" title="default">true</span>
              </h4>
              <p>A function that takes the req object and returns or yields true or false. This function is called on POST, PUT and DELETE requests and sends 403 (Forbidden) on false.</p>
              <h5>Examples</h5>
              <p>Sync</p>
              <pre class="hljs"><code>prereq: function (req) {
  if (req.isAuthenticated()) {
    return true
  }

  return false
}</code></pre>
              <p>Async</p>
              <pre class="hljs"><code>prereq: function (req, cb) {
  performAsyncLogic(function (err, result) {
    cb(err, true)
  })
}</code></pre>
            </li>
            <li>
              <h4>
                access
                <span class="label label-primary" title="type">string</span>
                <span class="label label-success" title="default">public</span>
              </h4>
              <p>A function that takes the req object and returns or yields 'public', 'private' or 'protected'. It is called on GET, POST and PUT requests and filters out the appropriate fields.</p>
              <h5>Examples</h5>
              <p>Sync:</p>
              <pre class="hljs"><code>access: function (req) {
  if (req.isAuthenticated()) {
    return req.user.isAdmin ? 'private' : 'protected'
  } else {
    return 'public'
  }
}</code></pre>
              <p>Async</p>
              <pre class="hljs"><code>access: function (req, cb) {
  performAsyncLogic(function (err, result) {
    cb(err, 'public')
  })
}</code></pre>
            </li>
            <li>
              <h4>
                plural
                <span class="label label-primary" title="type">boolean</span>
                <span class="label label-success" title="default">false</span>
              </h4>
              <p>If <code>true</code>, does not pluralize the database model name.</p>
            </li>
            <li>
              <h4>
                lowercase
                <span class="label label-primary" title="type">boolean</span>
                <span class="label label-success" title="default">false</span>
              </h4>
              <p>If <code>true</code>, calls <code>.toLowerCase()</code> on the model's name before generating the routes.</p>
            </li>
            <li>
              <h4>
                name
                <span class="label label-primary" title="type">string</span>
                <span class="label label-success" title="default">the model's name</span>
              </h4>
              <p>Used as the endpoint's name.</p>
            </li>
            <li>
              <h4>
                onError
                <span class="label label-primary" title="type">function</span>
                <span class="label label-success" title="default">send the entire mongoose error</span>
              </h4>
              <div class="alert alert-warning">
                <i class="glyphicon glyphicon-alert"></i> Leaving this as default will leak information about your database.
              </div>
              <p>A function with the signature <code>function (err, req, res, next)</code> that is used to output an error. <code>err</code> is the error object that is returned by mongoose.</p>
              <h5>Example</h5>
              <pre class="hljs"><code>onError: function (err, req, res, next) {
  next(err)
}</code></pre>
            </li>
            <li>
              <h4>
                outputFn
                <span class="label label-primary" title="type">function</span>
              </h4>
              <p>A function with the signature <code>function (res, result)</code> that is used to output the result. <code>res</code> is a restify or express response object and <code>result</code> is the data returned by mongoose.</p>
              <h5>Example</h5>
              <pre class="hljs"><code>outputFn: function (res, result) {
  if (result.length > 100) {
    result.length = 100
  }

  res.status(200).json(result)
}</code></pre>
            </li>
            <li>
              <h4>
                private
                <span class="label label-primary" title="type">array</span>
              </h4>
              <p>Array of fields which are only to be returned by queries that have private access.</p>
              <h5>Example</h5>
              <pre class="hljs"><code>private: ['topSecret', 'fields']</code></pre>
            </li>
            <li>
              <h4>
                protected
                <span class="label label-primary" title="type">array</span>
              </h4>
              <p>Array of fields which are only to be returned by queries that have private or protected access.
              <h5>Example</h5>
              <pre class="hljs"><code>private: ['somewhatSecret', 'keys']</code></pre>
            </li>
            <li>
              <h4>
                postProcess
                <span class="label label-primary" title="type">function</span>
              </h4>
              <p>A middleware to be called after a successful response has been sent. If an error is sent to the client, this is not called.</p>
              <h5>Example</h5>
              <pre class="hljs"><code>postProcess: function (req, res, next) {
  console.log('Successful %s request', req.method)
}</code></pre>
            </li>
            <li>
              <h4>
                lean
                <span class="label label-primary" title="type">boolean</span>
                <span class="label label-success" title="default">true</span>
              </h4>
              <p>Whether or not mongoose should use <code>.lean()</code> to convert results to plain old JavaScript objects. This is bad for performance, but allows returning virtuals, getters and setters.</p>
            </li>
            <li>
              <h4>
                findOneAndUpdate
                <span class="label label-primary" title="type">boolean</span>
                <span class="label label-success" title="default">true</span>
              </h4>
              <p>If <code>false</code>, will first find documents by id and then call save, allowing document middleware to be called. For more information regarding mongoose middleware, <a href="http://mongoosejs.com/docs/middleware.html">read the docs</a>.</p>
            </li>
            <li>
              <h4>
                findOneAndRemove
                <span class="label label-primary" title="type">boolean</span>
                <span class="label label-success" title="default">true</span>
              </h4>
              <p>If <code>false</code>, will first find documents by id and then call remove, allowing document middleware to be called. For more information regarding mongoose middleware, <a href="http://mongoosejs.com/docs/middleware.html">read the docs</a>.</p>
            </li>
            <li>
              <h4>
                contextFilter
                <span class="label label-primary" title="type">function</span>
              </h4>
              <p>A function with the signature <code>function (model, req, cb)</code> that allows request specific filtering.</p>
              <h5>Example</h5>
              <pre class="hljs"><code>contextFilter: function (model, req, cb) {
  cb(model.find({
    user: req.user._id
  }))
}</code></pre>
            </li>
            <li>
              <h4>
                postCreate
                <span class="label label-primary" title="type">function</span>
              </h4>
              <p>A function with the signature <code>function (res, result, done)</code> which is run after document creation.</p>
            </li>
            <li>
              <h4>
                postDelete
                <span class="label label-primary" title="type">function</span>
              </h4>
              <p>A function with the signature <code>function (res, result, done)</code> which is run after document deletion.</p>
            </li>
          </ul>

          <h3 id="defaults" class="section-header">
            <a class="section-anchor" href="#defaults">
              <span class="glyphicon glyphicon-link"></span>
            </a>defaults
          </h3>

          <pre class="hljs"><code>restify.defaults(options)</code></pre>
          <p><strong>options</strong>: same as above, sets this object as the defaults for anything you <code>.serve()</code> afterwards.</p>
        </section>
      </div>
      <div class="col-md-2">
        <nav id="nav" class="hidden-print hidden-xs hidden-sm" data-spy="affix">
          <ul class="nav">
            <li>
              <a href="#getting-started">Getting started</a>
              <ul class="nav">
                <li><a href="#express4">Express 4 app</a></li>
                <li><a href="#request">Request</a></li>
              </ul>
              <a href="#query">Query</a>
              <ul class="nav">
                <li><a href="#operators">Operators</a></li>
                <li><a href="#queries">Sort, skip and limit</a></li>
                <li><a href="#queries">Populate</a></li>
              </ul>
              <a href="#reference">Reference</a>
              <ul class="nav">
                <li><a href="#serve">serve</a></li>
                <li><a href="#defaults">defaults</a></li>
              </ul>
              <a href="https://github.com/florianholzapfel/express-restify-mongoose/graphs/contributors" target="github">Contributors</a>
              <a href="https://github.com/florianholzapfel/express-restify-mongoose/blob/master/LICENSE" target="github">License (MIT)</a>
            </li>
          </ul>
        </nav>
      </div>
    </div>

    <footer class="container-fluid">
      <div class="row">
        <div class="col-md-offset-1 col-md-7">
          <p class="copyright">express-restify-mongoose is maintained by <a href="https://github.com/florianholzapfel">florianholzapfel</a></p>
        </div>
      </div>
    </footer>

    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="js/main.js"></script>
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/styles/monokai_sublime.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.7/highlight.min.js"></script>
    <script>
      hljs.initHighlightingOnLoad()
    </script>

</body>

</html>